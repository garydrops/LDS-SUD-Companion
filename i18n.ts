import React, { createContext, useContext } from 'react';
import type { Language } from './types';

type Translations = { [key: string]: string | ((params: any) => string) };

const translations: { [lang in Language]: Translations } = {
  'pt-BR': {
    reading: 'Leitura',
    assistant: 'Assistente',
    openSettings: 'Abrir configurações',
    myLibrary: 'Minha Biblioteca',
    progress: 'Progresso',
    backToLibrary: 'Voltar para Biblioteca',
    chaptersRead: ({ completed, total }) => `${completed} de ${total} capítulos lidos`,
    markAll: 'Marcar Todos',
    unmarkAll: 'Desmarcar Todos',
    settings: 'Configurações',
    close: 'Fechar',
    theme: 'Tema',
    themeLight: 'Claro',
    themeDark: 'Escuro',
    language: 'Idioma',
    textSize: 'Tamanho do Texto',
    textSizeSmall: 'Pequeno',
    textSizeMedium: 'Médio',
    textSizeLarge: 'Grande',
    contentGeneratorTitle: 'Assistente de Conteúdo SUD',
    tabTalk: 'Discurso',
    tabLesson: 'Aula',
    centralTheme: 'Tema Central',
    attachFile: 'Anexar',
    fileLabel: 'Arquivo:',
    pasteReferenceText: 'Colar Texto de Referência',
    timeLabel: 'Tempo (minutos)',
    audienceLabel: 'Público-Alvo',
    audienceAdults: 'Adultos',
    audienceYouth: 'Jovens',
    audienceChildren: 'Crianças',
    generationModeLabel: 'Modo de Geração',
    genModeFull: 'Texto Completo',
    genModeTopics: 'Apenas Tópicos',
    doctrinalSourcesLabel: 'Fontes Doutrinárias (base)',
    sourceScriptures: 'Escrituras',
    sourceGC: 'Conf. Geral (Últimos 10 anos)',
    sourceLiahona: 'Liahona',
    sourceCFM: 'Vem, Segue-me',
    sourceManuals: 'Manuais (Geral)',
    sourceDiscourses: 'Discursos',
    generating: 'Gerando...',
    generateTalk: 'Gerar Discurso',
    generateLesson: 'Gerar Aula',
    suggestHymn: 'Sugerir Hino',
    errorFillTheme: 'Por favor, preencha o Tema Central.',
    errorDoctrine: 'O material fornecido parece conter elementos que divergem da doutrina oficial da Igreja. O aplicativo não pode processar esta solicitação para garantir a integridade doutrinária.',
    errorGeneratingContent: ({ message }) => `Erro ao gerar conteúdo: ${message}`,
    errorUnknown: 'Ocorreu um erro desconhecido.',
    errorHymnSuggest: 'Preencha o tema ou o texto de referência para sugerir hinos.',
    errorSuggestingHymns: ({ message }) => `Erro ao sugerir hinos: ${message}`,
    additionalQuestions: 'Perguntas Adicionais',
    errorGeneratingQuestions: ({ message }) => `Erro ao gerar perguntas: ${message}`,
    printContent: 'Imprimir Conteúdo',
    copiedToClipboard: 'Copiado para a área de transferência!',
    generatedContent: 'Conteúdo Gerado',
    copy: 'Copiar',
    saveAsPdf: 'Salvar como PDF',
    print: 'Imprimir',
    generateMoreQuestions: 'Gerar Mais Perguntas',
    setGoal: 'Definir Meta',
    editGoal: 'Editar Meta',
    readingGoalFor: ({ volumeName }) => `Meta para ${volumeName}`,
    targetDate: 'Data-Alvo',
    save: 'Salvar',
    removeGoal: 'Remover Meta',
    chaptersPerDay: 'capítulos/dia',
    chaptersPerDayShort: 'caps/dia',
  },
  'en-US': {
    reading: 'Reading',
    assistant: 'Assistant',
    openSettings: 'Open settings',
    myLibrary: 'My Library',
    progress: 'Progress',
    backToLibrary: 'Back to Library',
    chaptersRead: ({ completed, total }) => `${completed} of ${total} chapters read`,
    markAll: 'Mark All',
    unmarkAll: 'Unmark All',
    settings: 'Settings',
    close: 'Close',
    theme: 'Theme',
    themeLight: 'Light',
    themeDark: 'Dark',
    language: 'Language',
    textSize: 'Text Size',
    textSizeSmall: 'Small',
    textSizeMedium: 'Medium',
    textSizeLarge: 'Large',
    contentGeneratorTitle: 'LDS Content Assistant',
    tabTalk: 'Talk',
    tabLesson: 'Lesson',
    centralTheme: 'Central Theme',
    attachFile: 'Attach',
    fileLabel: 'File:',
    pasteReferenceText: 'Paste Reference Text',
    timeLabel: 'Time (minutes)',
    audienceLabel: 'Target Audience',
    audienceAdults: 'Adults',
    audienceYouth: 'Youth',
    audienceChildren: 'Children',
    generationModeLabel: 'Generation Mode',
    genModeFull: 'Full Text',
    genModeTopics: 'Topics Only',
    doctrinalSourcesLabel: 'Doctrinal Sources (base)',
    sourceScriptures: 'Scriptures',
    sourceGC: 'General Conf. (Last 10 years)',
    sourceLiahona: 'Liahona',
    sourceCFM: 'Come, Follow Me',
    sourceManuals: 'Manuals (General)',
    sourceDiscourses: 'Discourses',
    generating: 'Generating...',
    generateTalk: 'Generate Talk',
    generateLesson: 'Generate Lesson',
    suggestHymn: 'Suggest Hymn',
    errorFillTheme: 'Please fill in the Central Theme.',
    errorDoctrine: 'The provided material seems to contain elements that diverge from official Church doctrine. The application cannot process this request to ensure doctrinal integrity.',
    errorGeneratingContent: ({ message }) => `Error generating content: ${message}`,
    errorUnknown: 'An unknown error occurred.',
    errorHymnSuggest: 'Fill in the theme or reference text to suggest hymns.',
    errorSuggestingHymns: ({ message }) => `Error suggesting hymns: ${message}`,
    additionalQuestions: 'Additional Questions',
    errorGeneratingQuestions: ({ message }) => `Error generating questions: ${message}`,
    printContent: 'Print Content',
    copiedToClipboard: 'Copied to clipboard!',
    generatedContent: 'Generated Content',
    copy: 'Copy',
    saveAsPdf: 'Save as PDF',
    print: 'Print',
    generateMoreQuestions: 'Generate More Questions',
    setGoal: 'Set Goal',
    editGoal: 'Edit Goal',
    readingGoalFor: ({ volumeName }) => `Goal for ${volumeName}`,
    targetDate: 'Target Date',
    save: 'Save',
    removeGoal: 'Remove Goal',
    chaptersPerDay: 'chapters/day',
    chaptersPerDayShort: 'chaps/day',
  },
  'es-ES': {
    reading: 'Lectura',
    assistant: 'Asistente',
    openSettings: 'Abrir configuración',
    myLibrary: 'Mi Biblioteca',
    progress: 'Progreso',
    backToLibrary: 'Volver a la Biblioteca',
    chaptersRead: ({ completed, total }) => `${completed} de ${total} capítulos leídos`,
    markAll: 'Marcar Todos',
    unmarkAll: 'Desmarcar Todos',
    settings: 'Configuración',
    close: 'Cerrar',
    theme: 'Tema',
    themeLight: 'Claro',
    themeDark: 'Oscuro',
    language: 'Idioma',
    textSize: 'Tamaño del Texto',
    textSizeSmall: 'Pequeño',
    textSizeMedium: 'Mediano',
    textSizeLarge: 'Grande',
    contentGeneratorTitle: 'Asistente de Contenido SUD',
    tabTalk: 'Discurso',
    tabLesson: 'Lección',
    centralTheme: 'Tema Central',
    attachFile: 'Adjuntar',
    fileLabel: 'Archivo:',
    pasteReferenceText: 'Pegar Texto de Referencia',
    timeLabel: 'Tiempo (minutos)',
    audienceLabel: 'Público Objetivo',
    audienceAdults: 'Adultos',
    audienceYouth: 'Jóvenes',
    audienceChildren: 'Niños',
    generationModeLabel: 'Modo de Generación',
    genModeFull: 'Texto Completo',
    genModeTopics: 'Solo Temas',
    doctrinalSourcesLabel: 'Fuentes Doctrinales (base)',
    sourceScriptures: 'Escrituras',
    sourceGC: 'Conf. General (Últimos 10 años)',
    sourceLiahona: 'Liahona',
    sourceCFM: 'Ven, Sígueme',
    sourceManuals: 'Manuales (General)',
    sourceDiscourses: 'Discursos',
    generating: 'Generando...',
    generateTalk: 'Generar Discurso',
    generateLesson: 'Generar Lección',
    suggestHymn: 'Sugerir Himno',
    errorFillTheme: 'Por favor, rellene el Tema Central.',
    errorDoctrine: 'El material proporcionado parece contener elementos que divergen de la doctrina oficial de la Iglesia. La aplicación no puede procesar esta solicitud para garantizar la integridad doctrinal.',
    errorGeneratingContent: ({ message }) => `Error al generar contenido: ${message}`,
    errorUnknown: 'Ocurrió un error desconocido.',
    errorHymnSuggest: 'Rellene el tema o el texto de referencia para sugerir himnos.',
    errorSuggestingHymns: ({ message }) => `Error al sugerir himnos: ${message}`,
    additionalQuestions: 'Preguntas Adicionales',
    errorGeneratingQuestions: ({ message }) => `Error al generar preguntas: ${message}`,
    printContent: 'Imprimir Contenido',
    copiedToClipboard: '¡Copiado al portapapeles!',
    generatedContent: 'Contenido Generado',
    copy: 'Copiar',
    saveAsPdf: 'Guardar como PDF',
    print: 'Imprimir',
    generateMoreQuestions: 'Generar Más Preguntas',
    setGoal: 'Establecer Meta',
    editGoal: 'Editar Meta',
    readingGoalFor: ({ volumeName }) => `Meta para ${volumeName}`,
    targetDate: 'Fecha Límite',
    save: 'Guardar',
    removeGoal: 'Eliminar Meta',
    chaptersPerDay: 'capítulos/día',
    chaptersPerDayShort: 'caps/día',
  },
};

interface I18nContextType {
  language: Language;
  t: (key: string, params?: any) => string;
}

const I18nContext = createContext<I18nContextType>({
  language: 'pt-BR',
  t: (key) => key,
});

export const useI18n = () => useContext(I18nContext);

interface I18nProviderProps {
  children: React.ReactNode;
  language: Language;
}

export const I18nProvider: React.FC<I18nProviderProps> = ({ children, language }) => {
  const t = (key: string, params?: any): string => {
    const langTranslations = translations[language] || translations['en-US'];
    const translation = langTranslations[key];
    if (typeof translation === 'function') {
      return translation(params);
    }
    return translation || key;
  };

  // FIX: Replaced JSX with React.createElement to be compatible with a .ts file extension.
  // JSX syntax is only valid in .tsx files.
  return React.createElement(I18nContext.Provider, { value: { language, t } }, children);
};